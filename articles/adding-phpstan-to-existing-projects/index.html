<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Dave Liddament's technical blog">
    <meta name="author" content="Dave Liddament">

    <title>Dave Liddament</title>

    <!-- Bootstrap core CSS -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../css/custom.css" rel="stylesheet">
    <link href="../../css/prism.css" rel="stylesheet">

    <script src="https://kit.fontawesome.com/4dad72476f.js" crossorigin="anonymous"></script>


</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="../../">Dave Liddament</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                                    <li class="nav-item ">
                        <a class="nav-link" href="../../">Home
                                                    </a>
                    </li>
                                    <li class="nav-item ">
                        <a class="nav-link" href="../../talks">Talks
                                                    </a>
                    </li>
                                    <li class="nav-item active">
                        <a class="nav-link" href="../../articles">Articles
                            <span class="sr-only">(current)</span>                        </a>
                    </li>
                                    <li class="nav-item ">
                        <a class="nav-link" href="../../sarb">SARB
                                                    </a>
                    </li>
                            </ul>
        </div>
    </div>
</nav>

<!-- Page Content -->
<div class="container">

    
    <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-12">

            <!-- Title -->
            <h1 class="mt-4">Adding PHPStan to existing projects: Sell the dream, manage the expectations</h1>


            <p class="date">June 23rd 2023</p>
            <hr>

            
            <p>Do you want start using <a href="https://phpstan.org">PHPStan</a> on your projects, but are unsure if your team will be on board?</p>

<p>This article is inspired by <a href="https://twitter.com/ediar">@ediar</a>'s <a href="https://twitter.com/ediar/status/1618897483513626624">tweet</a>: <em>"Any advice to get my coworkers into static analysis? They think it requires too many type comments for just defensive programming, and is not worth it."</em></p>

<p>I thought I'd share my experience of introducing PHPStan to existing projects.</p>

<p>I've broken this series into 4 articles, they are the steps I'd recommend taking:</p>

<ol>
<li>Sell the dream but manage expectations (This article)</li>
<li>Initial scan</li>
<li>Soft launch</li>
<li>Full launch</li>
</ol>

<h2>Aim of article</h2>

<p>By the end of this article you should some ideas for talking to your team about adding PHPStan to your development process.
There are some suggestions for dealing with people who might object to the idea.</p>

<h3>Sell the dream but manage expectations</h3>

<p>I find that when trying to introduce new tools or processes, the main difficulty is not the technology, it is the people. 
Some people don't like change. Others don't understand, or dispute the value of something new.</p>

<p>For those who need a bit of convincing, it is important that they understand the eventual benefits and for you to acknowledge there will be a few bumps along the way.
No tool or process is a silver bullet. There will be pain points adding them into your workflow. However, the benefits should outweigh the pain.</p>

<h3>Benefits of static analysis</h3>

<p>When trying to persuade people to do something, in this case use PHPStan, it's always better if they come to the same point of view on their own. 
One way to do this is to reflect on current wins and problems of the existing development process.</p>

<p>It is worth asking questions that illustrate benefits of static analysis your team might already be experiencing (e.g. by using an IDE).
You can then illustrate how PHPStan will amplify these benefits:</p>

<ul>
<li>Does using an IDE speed up development? If so, how?</li>
<li>How does your IDE prevent you from introducing bugs?</li>
<li>How does your IDE help you to safely refactor?</li>
</ul>

<p>It's also worth asking questions that might pull out problems that PHPStan can help solve.</p>

<ul>
<li>What problems as a team have we been having recently?</li>
<li>What recent bugs have we had?</li>
<li>What difficulties refactoring have we had?</li>
<li>Does it feel too difficult to refactor safely?</li>
</ul>

<p>To help you with framing how PHPStan can increase the benefits, or help solve problems, here are some of the benefits I found.</p>

<h4>Finding bugs</h4>

<p>The most apparent benefit is that PHPStan will find bugs before they make it to production.
Using PHPStan for a few weeks is often enough to convince people. That's how I got hooked.
PHPStan also changes how you code, IMO, for the better.
You'll make fewer mistakes and your code is more robust.</p>

<h4>Safer refactoring</h4>

<p>After a few weeks of PHPStan use I realised that I got even greater value from it when I was refactoring code.
If I made a change to a bit of code (e.g. method signature), PHPStan can show me all other places I need to update too.
Sometimes a change will ripple through a codebase; I update a method signature, then I need to update all the callers, this in turn causes more changes.
All of which PHPStan can me identify.</p>

<p>On code bases with high type coverage but with low or no test coverage, it is still possible to safely refactor code with PHPStan.</p>

<p>PHPStan still helps on projects with high test coverage. Often the issues found by PHPStan are easier to understand and fix, than interpreting the failed tests.
I make PHPStan happy, before running tests.</p>

<h4>Custom language features</h4>

<p>PHPStan gives you <a href="https://phpstan.org/blog/generics-in-php-using-phpdocs">generics</a> out of the box.
You can also use PHPStan extensions to give you features that other languages have. E.g. <a href="https://github.com/DaveLiddament/php-language-extensions">PHP Language extensions</a></p>

<p>Probably the biggest benefit of all is that you can write your own PHPStan <a href="https://phpstan.org/developing-extensions/rules">custom rules</a> to enforce your own project's conventions automatically.
This is very powerful, especially for larger projects with many developers.</p>

<h3>Challenges of introducing PHPStan</h3>

<p>Adding PHPStan to your workflow is similar to adding a new member to your team. It is worth framing it as such,
so that your colleagues understand that initially things will slow down a bit, but in the long run it will be worth it.
In fact there are well established <a href="https://en.wikipedia.org/wiki/Tuckman%27s_stages_of_group_development">phases in team development</a>: forming, storming, norming, performing.</p>

<p>In the depths of the storming phase, remember that this an essential part of the journey to a better development process.
Appreciating of the end goal should help everyone through the difficult times.</p>

<p>There issues I've had adding PHPStan to a project include:</p>

<h4>You must add type information to everything</h4>

<p>To get the most accurate results out of PHPStan, all member data, method parameters and returns need type information.
We'll see why the next article.</p>

<p>Type information can either be provided as a type declaration. E.g.</p>

<pre><code class="php">function getPersonByEmail(string $email): Person {
  // Implementation
}
</code></pre>

<p>Or by type hints (docblocks):</p>

<pre><code class="php">/**
 * @param string $email
 * @return Person 
 */
function getPersonByEmail(string $email): Person {
  // Implementation
}
</code></pre>

<p>Sometimes you might need both, e.g. when specifying the types in arrays:</p>

<pre><code class="php">/** @return array&lt;int,Person&gt; */
function getPeople(): array {
  // Implementation that returns an array:
  // The array keys are integers
  // The array values are of type Person.
}
</code></pre>

<p>As it happens I believe that adding type information improves readability of code.</p>

<p>If you're working with someone who is against type information then you can ask them for their views on clean code.</p>

<p>With luck, they'll say something along the lines of... "Clean code is very important. Code should be self documenting. It's intention should be clear. Etc, etc."
In which case you can ask them, what is more self documenting and intention revealing than type information?</p>

<h4>You don't need to fix all the issues or add type information before we can write new code?</h4>

<p>Developers might worry that they need to fix existing code or add type information to everything before they can start writing new code.</p>

<p>Thanks to PHPStan's baseline feature, it is not necessary to fix all the issues before you can start writing new code.
All new code will have to pass static analysis, but existing code can be fixed as and when it is touched.</p>

<h4>You might have to change how you code</h4>

<p>Some code can be problematic for static analysers to understand. 
You might get errors reported that are not actually errors, however in many cases the code can be refactored to keep that static analysis tool happy. 
Often the refactored code is easier for humans to understand too. We'll look at examples of this in later articles.</p>

<h2>Let's get started...</h2>

<p>Hopefully you're closer to getting people onboard with using PHPStan. What kind of conversations did you have? 
What were the objections? How did you overcome them? Let me know on <a href="https://twitter.com/DaveLiddament">Twitter</a> or <a href="https://phpc.social/@DaveLiddament">Mastodon</a>.</p>

<p>The second part of this series will look at your type coverage to decide the best approach.</p>

        </div>


    </div>
    <!-- /.row -->


</div>
<!-- /.container -->

<!-- Footer -->
<footer class="py-5 bg-dark">
    <div class="container">
        <p class="m-0 text-center text-white">
            Copyright &copy; Dave Liddament 2018-2023
            <a class="social-circle" href="https://twitter.com/DaveLiddament"><i class="fa-brands fa-twitter"></i></a>
            <a class="social-circle" href="https://github.com/DaveLiddament"><i class="fa-brands fa-github"></i></a>
            <a class="social-circle" href="https://www.linkedin.com/in/daveliddament/"><i
                        class="fa-brands fa-linkedin"></i></a>
            <a class="social-circle" rel="me" href="https://phpc.social/@DaveLiddament"><i class="fa-brands fa-mastodon"></i></a>
        </p>
    </div>
    <!-- /.container -->
</footer>

<!-- Bootstrap core JavaScript -->
<script src="../../js/jquery.min.js"></script>
<script src="../../js/bootstrap.bundle.min.js"></script>
<script src="../../js/prism.js"></script>

</body>

</html>
